{% extends 'common/base.html' %}

{% block title %}ë‚ ì”¨ì˜í–¥ ë¶„ì„{% endblock %}

{% block content %}
    {% if selected_gu %}
        <h3 class="mb-3 text-dark-emphasis">
            <span class="text-primary fw-semibold">{{ selected_gu or 'ì„ íƒëœ ìì¹˜êµ¬ ì—†ìŒ' }}ì˜ ë‚ ì”¨ì˜í–¥ ë¶„ì„ë‚´ìš©ì…ë‹ˆë‹¤.</h3>
        </h3>
    {% else %}
        <h5 class="mb-3 text-muted">
            âš ï¸ ìì¹˜êµ¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
        </h5>
    {% endif %}

    <form method="POST" action="{{ url_for('main.weather') }}" style="margin-bottom: 20px;">
        <label for="gu" style="font-weight: blod; margin-right: 10px;">ìì¹˜êµ¬ ì„ íƒ:</label>
        <select name="gu" id="gu" style="padding: 5px 10px; font-size: 14px;">
            {% for gu in gu_list %}
                <option value="{{ gu }}" {% if gu == selected_gu %} selected {% endif %}>{{ gu }}</option>
            {% endfor %}
        </select>
        <button type="submit"
                id="submit-btn"
                style="padding: 5px 10px;
                       background-color: {% if selected_gu %} #ccc {% else %} #007BFF {% endif %};
                       color: white; border: none;
                       cursor: {% if selected_gu %} not-allowed {% else %} pointer {% endif %};"
                {% if selected_gu %} disabled {% endif %}>
            ë¶„ì„í•˜ê¸°
        </button>
    </form>

    {% if plot_img %}
    <div style="margin: 30px 0; text-align: center;">
        <img src = 'data:image/png;base64,{{ plot_img }}' style="max-width: 90%; border: 1px solid #ccc; box-shadow: 2px 2px 6px rgba(0,0,0,0.1);">
    </div>
    {% endif %}

    {% if p_values %}
    <hr style="margin: 40px 0;">
    <h4 style="color: #333; margin-bottom: 15px;"> ğŸ“Š T-testë¥¼ í†µí•œ p-value ë¶„ì„ ê²°ê³¼ </h4>
    <table style="width: 100%; border-collapse: collapse; text-align: center; font-size: 14px;">
        <thead>
            <tr style="background-color: #f5f5f5;">
                <th style="border: 1px solid #ccc; padding: 8px;">êµ¬ë¶„</th>
                <th style="border: 1px solid #ccc; padding: 8px;">p-value</th>
                <th style="border: 1px solid #ccc; padding: 8px;">ì˜í–¥ ì—¬ë¶€</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="border: 1px solid #ccc; padding: 8px;">ë²„ìŠ¤ ìŠ¹ì°¨</td>
                <td style="border: 1px solid #ccc; padding: 8px;">{{ p_values.bus_boarding }}</td>
                <td style="border: 1px solid #ccc; padding: 8px; color: {{ 'red' if p_values.bus_boarding < 0.05 else '#666' }};" >
                    {{ 'ë¹„ì˜ ì˜í–¥ì„ ë°›ìŒ' if p_values.bus_boarding < 0.05 else 'ë¹„ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠìŒ'}}
                </td>
            </tr>
            <tr>
                <td style="border: 1px solid #ccc; padding: 8px;">ë²„ìŠ¤ í•˜ì°¨</td>
                <td style="border: 1px solid #ccc; padding: 8px;">{{ p_values.bus_alighting }}</td>
                <td style="border: 1px solid #ccc; padding: 8px; color: {{ 'red' if p_values.bus_alighting < 0.05 else '#666' }};">
                    {{ 'ë¹„ì˜ ì˜í–¥ì„ ë°›ìŒ' if p_values.bus_alighting < 0.05 else 'ë¹„ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠìŒ' }}
                </td>
            </tr>
            <tr>
                <td style="border: 1px solid #ccc; padding: 8px;">ì§€í•˜ì²  ìŠ¹ì°¨</td>
                <td style="border: 1px solid #ccc; padding: 8px;">{{ p_values.subway_boarding }}</td>
                <td style="border: 1px solid #ccc; padding: 8px; color: {{ 'red' if p_values.subway_boarding < 0.05 else '#666' }};">
                    {{ 'ë¹„ì˜ ì˜í–¥ì„ ë°›ìŒ' if p_values.subway_boarding < 0.05 else 'ë¹„ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠìŒ'}}
                </td>
            </tr>
            <tr>
                <td style="border: 1px solid #ccc; padding: 8px;">ì§€í•˜ì²  í•˜ì°¨</td>
                <td style="border: 1px solid #ccc; padding: 8px;">{{ p_values.subway_alighting }}</td>
                <td style="border: 1px solid #ccc; padding: 8px; color: {{ 'red' if p_values.subway_alighting < 0.05 else '#666' }};">
                    {{ 'ë¹„ì˜ ì˜í–¥ì„ ë°›ìŒ' if p_values.subway_alighting < 0.05 else 'ë¹„ì˜ ì˜í–¥ì„ ë°›ì§€ ì•ŠìŒ'}}
                </td>
            </tr>
        </tbody>
    </table>
    {% endif %}

    <script>
        const guSelect = document.getElementById("gu");
        const submitBtn = document.querySelector("#submit-btn");
        const initialGu = "{{ selected_gu or '' }}"; //ì„œë²„ì—ì„œ ë°›ì€ ì´ˆê¸° ì„ íƒëœ êµ¬
    
        guSelect.addEventListener("change", () => {
            const currentGu = guSelect.value;

            if (currentGu === initialGu || guSelect.value === "") {
                submitBtn.disabled = true;
                submitBtn.style.backgroundColor = "#ccc";
                submitBtn.style.cursor = "not-allowed";
            } else {
                submitBtn.disabled = false;
                submitBtn.style.backgroundColor = "#007BFF";
                submitBtn.style.cursor = "pointer";
            }
        });
    
        // í˜ì´ì§€ ë¡œë”© ì‹œ ì´ˆê¸° ìƒíƒœ ë°˜ì˜
        if (guSelect.value === initialGu || guSelect.value === "") {
            submitBtn.disabled = true;
            submitBtn.style.backgroundColor = "#ccc";
            submitBtn.style.cursor = "not-allowed";
        }
    </script>
{% endblock %}